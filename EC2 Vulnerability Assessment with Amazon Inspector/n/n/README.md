# Use Amazon Inspector to Run a Vulnerability Assessment on an EC2 Instance

In this project, I will guide you through the process of provisioning an EC2 instance and conducting a vulnerability assessment using Amazon Inspector, including setting up an assessment target and template.

Amazon Inspector is an automated vulnerability management service that continually scans AWS workloads for software vulnerabilities and unintended network exposure.

Our task order will be as follows:

* Login to AWS Console
* Configure and launch an EC2 instance
* ssh into the EC2 instance
* Install the AWS Inspector Agent
* Create an Assessment Target and Template
* Run the Assessment Template
* Download the Assessment Report

## Step 1 - Login to AWS Console

Create an AWS account and log in using the credentials you created. Follow the link below to set up an AWS account if you have not already.

https://portal.aws.amazon.com/billing/signup?type=enterprise#/start/email 

## Step 2 - Configure and launch an EC2 Instance

In the "Services" menu navigate to EC2 or type "EC2" in the search bar to get to the EC2 menu. Click on the "Instances" option on the left panel and click the "Launch Instances" button. 
Name your instance whatever you like and stick to the default AMIs and Instance types. For this demo, we are using the Amazon Linux 2 AMI and the t2.micro Instance type. Both are AWS free tier eligible. 

See Example below:

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/1.png?raw=true">

Don't leave this menu yet! Time to configure the Security groups. Scroll down to "Network Settings", ensure your default VPC is selected then configure the following settings:

* Auto-assign public IP: Enable
* Select Create Security group
* Security group name: "Whatever name you decide"
* Description: Brief description of what this security group is used for

 Now time to add security group rules. A security group is a virtual firewall in AWS that controls outbound and inbound traffic in a cloud computing environment. 

 * For ssh, Select Add Security Group rule Button
 * Choose Type: ssh
 * Source: Select Anywhere

 * For Custom TCP Rule, select Add security group rule Button
 * Choose Type: Custom TCP
 * Port range 21
 * Source: Select Anywhere
 * Repeat for port range 20 and 23

See the below screenshots for a reference of Network and security group configurations:

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/Website%20Hosting%20with%20EC2/3.png?raw=true)](https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/3.png?raw=true)">

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/4.png?raw=true)">

Click the "Launch Instance" button and proceed to the next step!

## Step 3 - SSH into the EC2 instance

Navigate to the EC2 instance page and ensure your EC2 instance's state is running with 2/2 status checks passed. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/5.png?raw=true)">

Select the EC2 Instance Connect option and click on the "Connect: button. (Keep everything else as default). A new tab will open in your browser where you can execute Linux commands. Congrats you have successfully connected to your EC2 instance via SSH! 

## Step 4 - Install the AWS Inspector agent

The commands below will install the AWS Inspector Agent on your EC2 instance:

* Switches to root user VERY IMPORTANT:

```
sudo su 
```
* Download the agent using either of these commands:

```
wget https://inspector-agent.amazonaws.com/linux/latest/install

curl -O https://inspector-agent.amazonaws.com/linux/latest/install

```
* Install the agent:

```
sudo bash install
```
## Step 5 - Create an Assessment Target and Template

Navigate to AWS Inspector by typing "Inspector" in the search bar. You should reach a menu like the one below. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/6.png?raw=true)">

Expand the column on the left side and switch to Amazon Inspector Classic. The menu will change to something like this...

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/7.png?raw=true)">

Click the "Get Started" Button and let's begin building the assessment target!

You should see this menu, this is the AWS Inspector Dashboard

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/8.png?raw=true)">

In the left column click "Assessment Targets" then "Create". 

Be sure to give it a name (I named mine Practice), check all the boxes then click "Save" This will target all the EC2 instances associated with this AWS account. In this case, there will be only 1

Your assessment target is created!

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/9.png?raw=true)">

Now to create the assessment template. An assessment template allows you to specify a configuration for your assessment runs, including the following: Rules packages that Amazon Inspector Classic uses to evaluate your assessment target. Duration of the assessment run â€“ You can set the duration of an assessment run anywhere between 3 minutes to 24 hours

On the left column click "Assessment templates"

Click Create and fill in the following information:

* Name - (Whatever you specify)
* Target Name - (The name of your assessment target you just created)
* Rules packages - Select all four rules.
* Duration - 15 minutes (Can be longer or shorter if you like)
* Keep everything else as default and click "Create"

Example Below:

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/10.png?raw=true">

Once your template has been created, proceed to the next step to run your template to find vulnerabilities on your attached EC2 instance. 

## Step 6 - Run the Assessment Template

Select the Assessment Template you just created and click the "Run" Button. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/11.png?raw=true)">

You should see a pop-up that states that the assessment run has successfully started. It may take 15 min to an hour for the assessment to yield results based on how long you set the duration. Be patient, after the assessment is completed the number of findings should populate as shown below. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/12.png?raw=true)">

In my case, there  are 104 findings. You can click on each individual finding to see details including the severity, description, and recommendation to remediate. In the screenshot below, I expanded the first "HIGH" severity finding. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/13.png?raw=true)">

Onward to the last step!

## Step 5 - Download the Assessment Report

In the left column, click "Assessment Runs" 

You should see on the right, an option that says "Download report". Click that option and you will be prompted with a screen to download the vulnerability report in either HTML or PDF format. Once its ready it will open in a new tab in your browser. 

<img width="30000" alt="image" src="https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/14.png?raw=true)">

The Assessment report for this demo can be found in the link below:

[My Assessment Report] ([https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/review?templateURL=https://roble-files.s3.amazonaws.com/Hodan-Project/R53-failover.yml&stackName=HDN-Domain-Host](https://github.com/blacksmith121/AWS_Projects/blob/main/EC2%20Vulnerability%20Assessment%20with%20Amazon%20Inspector/n/n/Vulnerability_report.pdf))
